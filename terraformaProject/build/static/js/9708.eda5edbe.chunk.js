"use strict";(self.webpackChunkterraforma_systems=self.webpackChunkterraforma_systems||[]).push([[9708],{90053:(e,a,n)=>{n.d(a,{CA:()=>d,E8:()=>u,Tr:()=>o});var t,r,l,i=n(57528),s=n(70459);const o=(0,s.J1)(t||(t=(0,i.A)(["\nmutation CreateManualCategory($manualCategoryData: CreateManualCategoryDto!) {\n    createManualCategory(manualCategoryData: $manualCategoryData) {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n        parent {\n          uuid\n          name\n          description\n          image_url\n        }\n      }\n    }\n  }\n"]))),d=(0,s.J1)(r||(r=(0,i.A)(["\nmutation UpdateManualCategory($categoryId: String!, $manualCategoryData: UpdateManualCategoryDto!) {\n    updateManualCategory(categoryId: $categoryId, manualCategoryData: $manualCategoryData) {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n      }\n    }\n  }\n"]))),u=(0,s.J1)(l||(l=(0,i.A)(["\nmutation DeleteManualCategory($manualCategoryId: String!) {\n  deleteManualCategory(manualCategoryId: $manualCategoryId) {\n    message\n    data {\n      uuid\n      name\n      description\n      image_url\n      parent {\n        uuid\n        name\n        description\n        image_url\n      }\n    }\n  }\n}"])))},57981:(e,a,n)=>{n.d(a,{AH:()=>d,jP:()=>c,sv:()=>m,xq:()=>u});var t,r,l,i,s=n(57528),o=n(70459);const d=(0,o.J1)(t||(t=(0,s.A)(["\nquery GetManualCategories($sortOrder: String!, $sortField: String!, $limit: Float!, $page: Float!, $search: String!) {\n  getManualCategories(sortOrder: $sortOrder, sortField: $sortField, limit: $limit, page: $page, search: $search) {\n    message\n    data {\n      manualCategories {\n        uuid\n        name\n        description\n        image_url\n      \n      }\n      count\n    }\n  }\n}\n  "]))),u=(0,o.J1)(r||(r=(0,s.A)(["\n  query GetAllParentCategory {\n    getAllParentCategory {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n      }\n    }\n  }"]))),c=(0,o.J1)(l||(l=(0,s.A)(["\n  query GetManualCategoryById($manualCategoryId: String!) {\n    getManualCategoryById(manualCategoryId: $manualCategoryId) {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n        parent {\n          uuid\n          name\n          description\n          image_url\n        }\n      }\n    }\n  }"]))),m=(0,o.J1)(i||(i=(0,s.A)(["\n  query GetManualParentCategoryById($manualCategoryId: String!) {\n    getManualParentCategoryById(manualCategoryId: $manualCategoryId) {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n        children {\n          uuid\n          name\n          description\n          image_url\n        }\n      }\n    }\n  }"])))},89274:(e,a,n)=>{n.r(a),n.d(a,{default:()=>j});var t=n(65043),r=n(82485),l=n(63516),i=n(64526),s=n(72096),o=n(25263),d=n(33556),u=n(34764),c=n(41290),m=n(31881),g=n(88250),p=n(57981),h=n(90053),x=n(42145),b=n(12352),y=n(73216),v=n(55797),f=n(66925),C=(n(15675),n(59140),n(9686),n(70579));const j=e=>{var a;const n=(0,y.g)(),[j]=(0,m.n)(h.Tr),[w]=(0,m.n)(h.CA),{refetch:_}=(0,g.I)(p.sv,{variables:{manualCategoryId:n.id},skip:!n.id}),{addTechnicalManualValidationSchema:N}=(0,b.A)(),[A,D]=(0,t.useState)(!1),[I,S]=(0,t.useState)(!1),[M,$]=(0,t.useState)(!1),[k,F]=(0,t.useState)(""),R=(0,t.createRef)(),[B,q]=(0,t.useState)(!1),J=(0,t.useRef)(null),[z,E]=(0,t.useState)(!1),P=(0,l.Wx)({initialValues:{name:"",description:"",image_url:"",parent_id:""},validationSchema:N,onSubmit:async a=>{if(e.onData.uuid){const n={name:a.name,description:a.description,parent_id:a.parent_id?a.parent_id:"",image_url:a.image_url};w({variables:{manualCategoryData:n,categoryId:String(e.onData.uuid)}}).then((a=>{var n;const t=a.data;i.oR.success(null===t||void 0===t||null===(n=t.updateManualCategory)||void 0===n?void 0:n.message),P.resetForm(),e.dataRefetch(),G(),e.onCloseAddForm()})).catch((e=>{var a,n,t;i.oR.error(null===e||void 0===e||null===(a=e.networkError)||void 0===a||null===(n=a.result)||void 0===n||null===(t=n.errors[0])||void 0===t?void 0:t.message)}))}else j({variables:{manualCategoryData:{name:a.name,description:a.description,parent_id:""===a.parent_id?"":a.parent_id,image_url:a.image_url}}}).then((a=>{var n;const t=a.data;i.oR.success(null===t||void 0===t||null===(n=t.createManualCategory)||void 0===n?void 0:n.message),P.resetForm(),e.onData(_),e.onCloseAddForm()})).catch((e=>{i.oR.error(e.networkError.result.errors[0].message)}))}});(0,t.useEffect)((()=>{var a;D(!0),S(!0),null!==e&&void 0!==e&&null!==(a=e.onData)&&void 0!==a&&a.uuid&&$(!0)}),[e]),(0,t.useEffect)((()=>{n.id&&_({manualCategoryId:n.id}).catch((e=>i.oR.error(e)))}),[n.id]);const U=(0,t.useCallback)((e=>{e.preventDefault();const a=e.target.files;if(a&&a.length>0){const e=a[0];if(e.type.startsWith("image/"))if(e.size>5242880)i.oR.error("Image size must be less than 5MB");else{const a=new FileReader;a.onload=()=>{F(a.result),q(!0)},a.readAsDataURL(e)}else i.oR.error("Please select a valid image file")}J.current&&(J.current.value="")}),[]),V=e=>P.errors[e]&&P.touched[e]?P.errors[e]:"";(0,t.useEffect)((()=>{var a;null!==e&&void 0!==e&&null!==(a=e.onData)&&void 0!==a&&a.uuid&&P.setValues({name:e.onData.name,description:e.onData.description,parent_id:e.onData.parent_id,image_url:e.onData.image_url})}),[e]);const G=(0,t.useCallback)((()=>{D(!1)}),[]),O=(0,t.useCallback)((e=>{P.setFieldValue(e.target.name,(0,f.AW)(e))}),[]),T=()=>(0,C.jsxs)("div",{className:"flex justify-end gap-3 md:gap-5",children:[(0,C.jsx)(c.A,{className:"btn-secondary btn-normal w-full md:w-[160px] whitespace-nowrap",type:"button",label:"Cancel",onClick:()=>q(!1),title:"".concat((0,s.t)("Cancel"))}),(0,C.jsx)(c.A,{className:"btn-primary btn-normal w-full md:w-[160px] whitespace-nowrap",type:"button",disabled:z,label:"Save",onClick:()=>(async()=>{var e;if("undefined"!==typeof(null===(e=R.current)||void 0===e?void 0:e.cropper)){var a;await E(!0);let e=null;const n=(0,x.Si)(null===(a=R.current)||void 0===a?void 0:a.cropper.getCroppedCanvas().toDataURL(),"image.png"),t=new FormData;t.append("image",n),e=await(0,x.V6)(t,""),e&&(P.setFieldValue("image_url",e),q(!1)),await E(!1)}})()})]});return(0,C.jsxs)(C.Fragment,{children:[A&&(0,C.jsx)("div",{id:"defaultModal",tabIndex:-1,"data-modal-show":!0,"aria-hidden":"false",className:"fixed top-0 left-0 right-0 z-50 h-full bg-modal modal ".concat(A?"":"hidden"),children:(0,C.jsx)("div",{id:"changeUserStatusModel",tabIndex:-1,"data-modal-show":!0,"aria-hidden":"false",className:"py-5 flex items-center justify-center h-full ".concat(I?"":"opacity-0 transform -translate-y-full scale-150 "," transition-all duration-300 "),children:(0,C.jsx)("div",{className:"w-full mx-5 sm:max-w-[780px]",children:(0,C.jsxs)("div",{className:"relative bg-white rounded-xl",children:[(0,C.jsxs)("div",{className:"flex items-center justify-between p-5 border-b md:py-6 bg-accents-2 rounded-t-xl",children:[(0,C.jsx)("h6",{children:M?"Update Manual":"Add Manual"}),M?(0,C.jsx)(c.A,{onClick:G,label:(0,s.t)(""),children:(0,C.jsx)("span",{className:"text-xl-22",children:(0,C.jsx)(d.YY,{className:"text-error"})})}):(0,C.jsx)(c.A,{onClick:e.onCloseAddForm,label:(0,s.t)(""),children:(0,C.jsx)("span",{className:"text-xl-22",children:(0,C.jsx)(d.YY,{className:"text-error"})})})]}),(0,C.jsx)("div",{className:"w-full ",children:(0,C.jsxs)("form",{onSubmit:P.handleSubmit,children:[(0,C.jsxs)("div",{className:"p-5 bg-white max-h-[calc(100vh-260px)] overflow-auto",children:[(0,C.jsxs)("div",{className:"mb-2 text-right",children:[(0,s.t)("Fields marked with")," ",(0,C.jsx)("span",{className:"text-red-500",children:"*"})," ",(0,s.t)("are mandatory.")]}),(0,C.jsx)("div",{className:"mb-3",children:(0,C.jsxs)("div",{className:"box-border flex flex-col items-center justify-center p-5 mb-5 border border-solid border-border-primary rounded-xl",children:[(0,C.jsxs)("label",{htmlFor:"image_url",className:"relative flex flex-col items-center justify-center",children:[(0,C.jsx)("div",{className:"flex items-center justify-center w-32 h-32 overflow-hidden border border-gray-300 border-solid rounded-full cursor-pointer sm:w-44 sm:h-44",children:null!==P&&void 0!==P&&null!==(a=P.values)&&void 0!==a&&a.image_url?(0,C.jsx)("img",{src:"".concat("https://terraforma-staging.s3.us-west-2.amazonaws.com","/").concat(P.values.image_url),alt:"image_url",className:"object-contain w-full h-full bg-black"}):(0,C.jsx)("img",{src:o,alt:"image_url",className:"object-contain w-full h-full bg-black"})}),(0,C.jsx)("input",{type:"file",id:"image_url",name:"image_url",accept:"image/*",onChange:U,ref:J,className:"hidden"}),(0,C.jsx)("div",{className:"absolute bottom-0 p-2 text-2xl font-bold text-white rounded-full right-1 sm:right-2 bg-primary",children:(0,C.jsx)(d.i7,{})})]}),P.errors.image_url&&P.touched.image_url?(0,C.jsx)("span",{className:"relative mt-2 md:text-xs-15 error",children:P.errors.image_url}):""]})}),(0,C.jsx)("div",{className:"mb-3",children:(0,C.jsx)(u.A,{onBlur:O,placeholder:(0,s.t)("Name"),required:!0,name:"name",onChange:P.handleChange,label:(0,s.t)("Name"),value:P.values.name,error:V("name")})}),(0,C.jsx)("div",{children:(0,C.jsx)(u.A,{onBlur:O,placeholder:(0,s.t)("Description"),required:!0,name:"description",onChange:P.handleChange,label:(0,s.t)("Description"),value:P.values.description,error:V("description")})})]}),(0,C.jsxs)("div",{className:"flex flex-col items-center justify-end p-5 border-t border-solid md:space-x-5 md:flex-row border-border-primary",children:[(0,C.jsx)(c.A,{className:"btn-primary btn-normal mb-3 md:mb-0 w-full md:w-[160px]",type:"submit",label:(0,s.t)("Save"),title:"".concat((0,s.t)("Save"))}),M?(0,C.jsx)(c.A,{className:"btn-secondary btn-normal w-full md:w-[160px]",label:(0,s.t)("Cancel"),onClick:G,title:"".concat((0,s.t)("Cancel"))}):(0,C.jsx)(c.A,{className:"btn-secondary btn-normal w-full md:w-[160px]",label:(0,s.t)("Cancel"),onClick:e.onCloseAddForm,title:"".concat((0,s.t)("Cancel"))})]})]})})]})})})}),(0,C.jsx)(v.l,{className:"custom-dialog",header:"Crop Image",visible:B,style:{width:"50vw"},onHide:()=>q(!1),footer:()=>T(),children:k&&(0,C.jsx)(r.A,{ref:R,style:{height:400,width:"100%"},zoomTo:.5,aspectRatio:1,preview:".img-preview",src:k,viewMode:1,minCropBoxHeight:10,minCropBoxWidth:10,background:!1,responsive:!0,autoCropArea:1,checkOrientation:!1,guides:!0,cropBoxResizable:!1})})]})}},25263:(e,a,n)=>{e.exports=n.p+"static/media/sidebar-logo.d6fce7850bbfb0f38fbe.png"}}]);
//# sourceMappingURL=9708.eda5edbe.chunk.js.map