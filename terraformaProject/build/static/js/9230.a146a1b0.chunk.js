"use strict";(self.webpackChunkterraforma_systems=self.webpackChunkterraforma_systems||[]).push([[9230],{90053:(e,a,n)=>{n.d(a,{CA:()=>d,E8:()=>u,Tr:()=>o});var t,r,l,i=n(57528),s=n(70459);const o=(0,s.J1)(t||(t=(0,i.A)(["\nmutation CreateManualCategory($manualCategoryData: CreateManualCategoryDto!) {\n    createManualCategory(manualCategoryData: $manualCategoryData) {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n        parent {\n          uuid\n          name\n          description\n          image_url\n        }\n      }\n    }\n  }\n"]))),d=(0,s.J1)(r||(r=(0,i.A)(["\nmutation UpdateManualCategory($categoryId: String!, $manualCategoryData: UpdateManualCategoryDto!) {\n    updateManualCategory(categoryId: $categoryId, manualCategoryData: $manualCategoryData) {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n      }\n    }\n  }\n"]))),u=(0,s.J1)(l||(l=(0,i.A)(["\nmutation DeleteManualCategory($manualCategoryId: String!) {\n  deleteManualCategory(manualCategoryId: $manualCategoryId) {\n    message\n    data {\n      uuid\n      name\n      description\n      image_url\n      parent {\n        uuid\n        name\n        description\n        image_url\n      }\n    }\n  }\n}"])))},57981:(e,a,n)=>{n.d(a,{AH:()=>d,jP:()=>c,sv:()=>m,xq:()=>u});var t,r,l,i,s=n(57528),o=n(70459);const d=(0,o.J1)(t||(t=(0,s.A)(["\nquery GetManualCategories($sortOrder: String!, $sortField: String!, $limit: Float!, $page: Float!, $search: String!) {\n  getManualCategories(sortOrder: $sortOrder, sortField: $sortField, limit: $limit, page: $page, search: $search) {\n    message\n    data {\n      manualCategories {\n        uuid\n        name\n        description\n        image_url\n      \n      }\n      count\n    }\n  }\n}\n  "]))),u=(0,o.J1)(r||(r=(0,s.A)(["\n  query GetAllParentCategory {\n    getAllParentCategory {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n      }\n    }\n  }"]))),c=(0,o.J1)(l||(l=(0,s.A)(["\n  query GetManualCategoryById($manualCategoryId: String!) {\n    getManualCategoryById(manualCategoryId: $manualCategoryId) {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n        parent {\n          uuid\n          name\n          description\n          image_url\n        }\n      }\n    }\n  }"]))),m=(0,o.J1)(i||(i=(0,s.A)(["\n  query GetManualParentCategoryById($manualCategoryId: String!) {\n    getManualParentCategoryById(manualCategoryId: $manualCategoryId) {\n      message\n      data {\n        uuid\n        name\n        description\n        image_url\n        children {\n          uuid\n          name\n          description\n          image_url\n        }\n      }\n    }\n  }"])))},93852:(e,a,n)=>{n.r(a),n.d(a,{default:()=>w});var t=n(65043),r=n(63516),l=n(72096),i=n(73216),s=n(64526),o=n(55797),d=(n(15675),n(59140),n(82485)),u=(n(9686),n(25263)),c=n(33556),m=n(8848),g=n(34764),p=n(41290),h=n(88250),x=n(31881),v=n(57981),b=n(90053),y=n(42145),C=n(12352),f=n(66925),j=n(70579);const w=e=>{var a;const[n,w]=(0,t.useState)([]),_=(0,i.g)(),{data:N,refetch:A}=(0,h.I)(v.xq),[D]=(0,x.n)(b.Tr),[S]=(0,x.n)(b.CA),{data:I,refetch:k}=(0,h.I)(v.jP,{variables:{subscribersId:_.id},skip:!_.id}),{addTechnicalManualChildValidationSchema:M}=(0,C.A)(),[$,F]=(0,t.useState)(!1),[R,B]=(0,t.useState)(!1),[P,q]=(0,t.useState)(""),E=(0,t.createRef)(),[J,z]=(0,t.useState)(!1),[U,V]=(0,t.useState)(!1),G=(0,t.useRef)(null),[O,T]=(0,t.useState)(!1),W=(0,r.Wx)({initialValues:{name:"",description:"",image_url:"",parent_id:""},validationSchema:M,onSubmit:async a=>{if(e.onData.uuid){const n={name:a.name,description:a.description,parent_id:a.parent_id,image_url:a.image_url};S({variables:{manualCategoryData:n,categoryId:String(e.onData.uuid)}}).then((a=>{var n;const t=a.data;s.oR.success(null===t||void 0===t||null===(n=t.updateManualCategory)||void 0===n?void 0:n.message),W.resetForm(),e.dataRefetch(),Q(),e.onCloseAddForm()})).catch((e=>{var a,n,t;s.oR.error(null===e||void 0===e||null===(a=e.networkError)||void 0===a||null===(n=a.result)||void 0===n||null===(t=n.errors[0])||void 0===t?void 0:t.message)}))}else D({variables:{manualCategoryData:{name:a.name,description:a.description,parent_id:a.parent_id,image_url:a.image_url}}}).then((a=>{var n;const t=a.data;s.oR.success(null===t||void 0===t||null===(n=t.createManualCategory)||void 0===n?void 0:n.message),W.resetForm(),e.onCloseAddForm(),e.onData(k)})).catch((e=>{var a,n,t;s.oR.error(null===e||void 0===e||null===(a=e.networkError)||void 0===a||null===(n=a.result)||void 0===n||null===(t=n.errors[0])||void 0===t?void 0:t.message)}))}});(0,t.useEffect)((()=>{var a;F(!0),B(!0),null!==e&&void 0!==e&&null!==(a=e.onData)&&void 0!==a&&a.uuid&&V(!0)}),[e]),(0,t.useEffect)((()=>{e.onData.uuid&&k({manualCategoryId:e.onData.uuid}).catch((e=>s.oR.error(e)))}),[e.onData.uuid]),(0,t.useEffect)((()=>{var e,a;A();const n=[];null===N||void 0===N||null===(e=N.getAllParentCategory)||void 0===e||null===(a=e.data)||void 0===a||a.map((e=>{n.push({name:null===e||void 0===e?void 0:e.name,key:null===e||void 0===e?void 0:e.uuid})})),w(n)}),[N]);const Y=(0,t.useCallback)((e=>{W.handleChange(e)}),[]),H=(0,t.useCallback)((e=>{e.preventDefault();const a=e.target.files;if(a&&a.length>0){const e=a[0];if(e.type.startsWith("image/"))if(e.size>5242880)s.oR.error("Image size must be less than 5MB");else{const a=new FileReader;a.onload=()=>{q(a.result),z(!0)},a.readAsDataURL(e)}else s.oR.error("Please select a valid image file")}G.current&&(G.current.value="")}),[]),L=e=>W.errors[e]&&W.touched[e]?W.errors[e]:"",K=(0,t.useCallback)((e=>{W.setFieldValue(e.target.name,(0,f.AW)(e))}),[]);(0,t.useEffect)((()=>{e.onData.uuid&&W.setValues({name:e.onData.name,description:e.onData.description,parent_id:e.onData.parent.uuid,image_url:e.onData.image_url})}),[I]);const Q=(0,t.useCallback)((()=>{F(!1),e.onCloseAddForm()}),[]),X=()=>(0,j.jsxs)("div",{className:"flex justify-end gap-3 md:gap-5",children:[(0,j.jsx)(p.A,{className:"btn-secondary btn-normal w-full md:w-[160px] whitespace-nowrap",type:"button",label:"Cancel",onClick:()=>z(!1),title:"".concat((0,l.t)("Cancel"))}),(0,j.jsx)(p.A,{className:"btn-primary btn-normal w-full md:w-[160px] whitespace-nowrap",type:"button",label:"Save",disabled:O,onClick:()=>(async()=>{var e;if("undefined"!==typeof(null===(e=E.current)||void 0===e?void 0:e.cropper)){var a;await T(!0);let e=null;const n=(0,y.Si)(null===(a=E.current)||void 0===a?void 0:a.cropper.getCroppedCanvas().toDataURL(),"image.png"),t=new FormData;t.append("image",n),e=await(0,y.V6)(t,""),e&&(W.setFieldValue("image_url",e),z(!1)),await T(!1)}})(),title:"".concat((0,l.t)("Save"))})]});return(0,j.jsxs)(j.Fragment,{children:[$&&(0,j.jsx)("div",{id:"defaultModal",tabIndex:-1,"data-modal-show":!0,"aria-hidden":"false",className:"fixed top-0 left-0 right-0 z-50 h-full bg-modal modal ".concat($?"":"hidden"),children:(0,j.jsx)("div",{id:"changeUserStatusModel",tabIndex:-1,"data-modal-show":!0,"aria-hidden":"false",className:"py-5 flex items-center justify-center h-full ".concat(R?"":"opacity-0 transform -translate-y-full scale-150 "," transition-all duration-300 "),children:(0,j.jsx)("div",{className:"w-full mx-5 sm:max-w-[780px]",children:(0,j.jsxs)("div",{className:"relative bg-white rounded-xl",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between p-5 border-b md:py-6 bg-accents-2 rounded-t-xl",children:[(0,j.jsx)("h6",{children:U?"Update Manual":"Add Manual"}),U?(0,j.jsxs)(j.Fragment,{children:["     ",(0,j.jsx)(p.A,{onClick:Q,label:(0,l.t)(""),title:"".concat((0,l.t)("Close")),children:(0,j.jsx)("span",{className:"text-xl-22",children:(0,j.jsx)(c.YY,{className:"text-error"})})})]}):(0,j.jsxs)(j.Fragment,{children:["     ",(0,j.jsx)(p.A,{onClick:e.onCloseAddForm,label:(0,l.t)(""),title:"".concat((0,l.t)("Close")),children:(0,j.jsx)("span",{className:"text-xl-22",children:(0,j.jsx)(c.YY,{className:"text-error"})})})]})]}),(0,j.jsx)("div",{className:"w-full ",children:(0,j.jsxs)("form",{onSubmit:W.handleSubmit,children:[(0,j.jsxs)("div",{className:"p-5 bg-white max-h-[calc(100vh-260px)] overflow-auto",children:[(0,j.jsxs)("div",{className:"mb-2 text-right",children:[(0,l.t)("Fields marked with")," ",(0,j.jsx)("span",{className:"text-red-500",children:"*"})," ",(0,l.t)("are mandatory.")]}),(0,j.jsxs)("div",{className:"mb-3",children:[(0,j.jsxs)("div",{className:"box-border flex flex-col items-center justify-center p-5 mb-5 border border-solid border-border-primary rounded-xl",children:[(0,j.jsxs)("label",{htmlFor:"image_url",className:"relative flex flex-col items-center justify-center",children:[(0,j.jsx)("div",{className:"flex items-center justify-center w-32 h-32 overflow-hidden border border-gray-300 border-solid rounded-full cursor-pointer sm:w-44 sm:h-44",children:null!==W&&void 0!==W&&null!==(a=W.values)&&void 0!==a&&a.image_url?(0,j.jsx)("img",{src:"".concat("https://terraforma-staging.s3.us-west-2.amazonaws.com","/").concat(W.values.image_url),alt:"image_url",className:"object-contain w-full h-full bg-black"}):(0,j.jsx)("img",{src:u,alt:"image_url",className:"object-contain w-full h-full bg-black"})}),(0,j.jsx)("input",{type:"file",id:"image_url",name:"image_url",accept:"image/*",onChange:H,ref:G,className:"hidden"}),(0,j.jsx)("div",{className:"absolute bottom-0 p-2 text-2xl font-bold text-white rounded-full right-1 sm:right-2 bg-primary",children:(0,j.jsx)(c.i7,{})})]}),W.errors.image_url&&W.touched.image_url?(0,j.jsx)("span",{className:"relative mt-2 md:text-xs-15 error",children:W.errors.image_url}):""]}),(0,j.jsx)("div",{className:"mb-4",children:(0,j.jsx)(m.A,{placeholder:(0,l.t)("Select Parent Category"),required:!0,name:"parent_id",onChange:Y,value:W.values.parent_id,id:"parentCategory",label:(0,l.t)("Parent Category"),options:n,error:L("parent_id")})})]}),(0,j.jsx)("div",{className:"mb-3",children:(0,j.jsx)(g.A,{onBlur:K,placeholder:(0,l.t)("Name"),required:!0,name:"name",onChange:W.handleChange,label:(0,l.t)("Name"),value:W.values.name,error:L("name")})}),(0,j.jsx)("div",{className:"mb-3",children:(0,j.jsx)(g.A,{onBlur:K,placeholder:(0,l.t)("Description"),required:!0,name:"description",onChange:W.handleChange,label:(0,l.t)("Description"),value:W.values.description,error:L("description")})})]}),(0,j.jsxs)("div",{className:"flex flex-col items-center justify-end p-5 border-t border-solid md:space-x-3 md:flex-row border-border-primary",children:[(0,j.jsx)(p.A,{className:"btn-primary btn-normal mb-3 md:mb-0 w-full md:w-[160px]",type:"submit",label:(0,l.t)("Save"),title:"".concat((0,l.t)("Save"))}),U?(0,j.jsx)(p.A,{className:"btn-secondary btn-normal w-full md:w-[160px]",label:(0,l.t)("Cancel"),onClick:Q,title:"".concat((0,l.t)("Cancel"))}):(0,j.jsx)(p.A,{className:"btn-secondary btn-normal w-full md:w-[160px]",label:(0,l.t)("Cancel"),onClick:e.onCloseAddForm,title:"".concat((0,l.t)("Cancel"))})]})]})})]})})})}),(0,j.jsx)(o.l,{className:"custom-dialog",header:"Crop Image",visible:J,style:{width:"50vw"},onHide:()=>z(!1),footer:()=>X(),children:P&&(0,j.jsx)(d.A,{ref:E,style:{height:400,width:"100%"},zoomTo:.5,aspectRatio:1,preview:".img-preview",src:P,viewMode:1,minCropBoxHeight:10,minCropBoxWidth:10,background:!1,responsive:!0,autoCropArea:1,checkOrientation:!1,guides:!0,cropBoxResizable:!1})})]})}},25263:(e,a,n)=>{e.exports=n.p+"static/media/sidebar-logo.d6fce7850bbfb0f38fbe.png"}}]);
//# sourceMappingURL=9230.a146a1b0.chunk.js.map