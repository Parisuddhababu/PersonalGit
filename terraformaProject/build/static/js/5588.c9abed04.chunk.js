"use strict";(self.webpackChunkterraforma_systems=self.webpackChunkterraforma_systems||[]).push([[5588],{36238:(e,n,a)=>{a.d(n,{A:()=>r});var t=a(65043),o=a(74117),s=a(70579);const r=e=>{let{errors:n,touched:a,setFieldTouched:r,children:l}=e;return((e,n,a)=>{const{i18n:s}=(0,o.Bd)();(0,t.useEffect)((()=>(s.on("languageChanged",(()=>{Object.keys(e).forEach((e=>{Object.keys(n).includes(e)&&a(e)}))})),()=>{s.off("languageChanged",(()=>{}))})),[e])})(n,a,r),(0,s.jsx)(s.Fragment,{children:l})}},10463:(e,n,a)=>{a.d(n,{AL:()=>m,D2:()=>p,L4:()=>c,Pn:()=>u,f9:()=>g});var t,o,s,r,l,i=a(57528),d=a(70459);const u=(0,d.J1)(t||(t=(0,i.A)(["\n  mutation Mutation($deleteCouponId: Int) {\n    deleteCoupon(id: $deleteCouponId) {\n      data {\n        id\n        uuid\n        coupon_name\n        coupon_code\n        coupon_type\n        percentage\n        start_time\n        expire_time\n        applicable\n        total_usage\n        status\n        created_by\n        created_at\n        updated_at\n      }\n      meta {\n        message\n        messageCode\n        statusCode\n        status\n        type\n        errors {\n          errorField\n          error\n        }\n        errorType\n      }\n    }\n  }\n"]))),p=(0,d.J1)(o||(o=(0,i.A)(["\n  mutation UpdateCouponStatus($updateCouponStatusId: Int!, $status: Int) {\n    updateCouponStatus(id: $updateCouponStatusId, status: $status) {\n      data {\n        id\n        uuid\n        coupon_name\n        coupon_code\n        coupon_type\n        percentage\n        start_time\n        expire_time\n        applicable\n        total_usage\n        status\n        created_by\n        created_at\n        updated_at\n      }\n      meta {\n        message\n        messageCode\n        statusCode\n        status\n        type\n        errors {\n          errorField\n          error\n        }\n        errorType\n      }\n    }\n  }\n"]))),c=(0,d.J1)(s||(s=(0,i.A)(["\n  mutation Mutation(\n    $updateCouponId: Int\n    $couponName: String\n    $couponCode: String\n    $couponType: Int\n    $percentage: Float\n    $startTime: Date\n    $expireTime: Date\n    $isReusable: Int\n    $applicable: Int\n    $selectedUsers: [Int]\n  ) {\n    updateCoupon(\n      id: $updateCouponId\n      coupon_name: $couponName\n      coupon_code: $couponCode\n      coupon_type: $couponType\n      percentage: $percentage\n      start_time: $startTime\n      expire_time: $expireTime\n      is_reusable: $isReusable\n      applicable: $applicable\n      selected_users: $selectedUsers\n    ) {\n      data {\n        id\n        uuid\n        coupon_name\n        coupon_code\n        coupon_type\n        percentage\n        start_time\n        expire_time\n        applicable\n        is_reusable\n        selected_users\n\n        created_by\n        created_at\n        updated_at\n      }\n      meta {\n        message\n        messageCode\n        statusCode\n        status\n        type\n        errors {\n          errorField\n          error\n        }\n        errorType\n      }\n    }\n  }\n"]))),m=(0,d.J1)(r||(r=(0,i.A)(["\n  mutation Mutation(\n    $couponName: String\n    $couponCode: String\n    $couponType: Int\n    $percentage: Float\n    $startTime: Date\n    $expireTime: Date\n    $applicable: Int\n    $status: Int\n    $createdBy: Int\n    $selectedUsers: [Int]\n    $isReusable: Int\n  ) {\n    createCoupon(\n      coupon_name: $couponName\n      coupon_code: $couponCode\n      coupon_type: $couponType\n      percentage: $percentage\n      start_time: $startTime\n      expire_time: $expireTime\n      applicable: $applicable\n      status: $status\n      created_by: $createdBy\n      selected_users: $selectedUsers\n      is_reusable: $isReusable\n    ) {\n      data {\n        id\n        uuid\n        coupon_name\n        coupon_code\n        coupon_type\n        percentage\n        start_time\n        expire_time\n        applicable\n        status\n        created_by\n        created_at\n        updated_at\n      }\n      meta {\n        message\n        messageCode\n        statusCode\n        status\n        type\n        errors {\n          errorField\n          error\n        }\n        errorType\n      }\n    }\n  }\n"]))),g=(0,d.J1)(l||(l=(0,i.A)([" mutation GroupDeleteCoupons($groupDeleteCouponsId: [Int]) {\n  groupDeleteCoupons(id: $groupDeleteCouponsId) {\n    meta {\n      message\n      messageCode\n      statusCode\n      status\n      type\n      errors {\n        errorField\n        error\n      }\n      errorType\n    }\n  }\n}"])))},82887:(e,n,a)=>{a.d(n,{I:()=>i,L:()=>l});var t,o,s=a(57528),r=a(70459);const l=(0,r.J1)(t||(t=(0,s.A)(["\n  query FetchCoupons(\n    $page: Int\n    $limit: Int\n    $sortBy: String\n    $sortOrder: String\n    $couponName: String\n    $startTime: Date\n    $expireTime: Date\n    $status: Int\n  ) {\n    fetchCoupons(\n      page: $page\n      limit: $limit\n      sortBy: $sortBy\n      sortOrder: $sortOrder\n      coupon_name: $couponName\n      start_time: $startTime\n      expire_time: $expireTime\n      status: $status\n    ) {\n      data {\n        Coupondata {\n          id\n          uuid\n          coupon_name\n          coupon_code\n          coupon_type\n          percentage\n          start_time\n          expire_time\n          applicable\n          is_reusable\n          total_usage\n          selected_users\n          status\n          created_by\n          created_at\n          updated_at\n        }\n        count\n      }\n      meta {\n        message\n        messageCode\n        statusCode\n        status\n        type\n        errors {\n          errorField\n          error\n        }\n        errorType\n      }\n    }\n  }\n"]))),i=(0,r.J1)(o||(o=(0,s.A)(["\n  query GetSingleCoupon($getSingleCouponId: Int) {\n    getSingleCoupon(id: $getSingleCouponId) {\n      data {\n        coupon {\n          id\n          uuid\n          coupon_name\n          coupon_code\n          coupon_type\n          percentage\n          start_time\n          expire_time\n          applicable\n          is_reusable\n          total_usage\n          selected_users\n          status\n          created_by\n          created_at\n          updated_at\n        }\n        userList {\n          id\n          uuid\n          first_name\n          middle_name\n          last_name\n          user_name\n          email\n          gender\n          date_of_birth\n          phone_no\n          phone_country_id\n          role\n          profile_img\n          device_type\n          status\n          user_role_id\n          created_at\n          updated_at\n        }\n      }\n      meta {\n        message\n        messageCode\n        statusCode\n        status\n        type\n        errors {\n          errorField\n          error\n        }\n        errorType\n      }\n    }\n  }\n"])))},55588:(e,n,a)=>{a.r(n),a.d(n,{default:()=>j});var t=a(88250),o=a(31881),s=a(42145),r=a(10463),l=a(82887),i=a(65043),d=a(74117),u=a(73216),p=a(64526),c=a(12352),m=a(63516),g=a(34764),b=a(36413),v=a(41290),_=a(33556),h=a(91188),C=a(66925),y=a(86178),x=a.n(y),$=a(13370),T=(a(15675),a(59140),a(36238)),f=a(70579);const j=()=>{const{t:e}=(0,d.Bd)(),n=(0,u.Zp)(),a=(0,u.g)(),{data:y}=(0,t.I)(b.F2),{data:j,refetch:I}=(0,t.I)(l.I),[S]=(0,o.n)(r.AL),[N]=(0,o.n)(r.L4),{addCoupenValidationSchema:A}=(0,c.A)(),[F,D]=(0,i.useState)([]),[R,k]=(0,i.useState)([]);(0,i.useEffect)((()=>{null!==a&&void 0!==a&&a.id&&I({getSingleCouponId:parseInt(a.id)}).catch((e=>{p.oR.error(e)}))}),[null===a||void 0===a?void 0:a.id]),(0,i.useEffect)((()=>{if(null!==j&&void 0!==j&&j.getSingleCoupon&&a.id){var e,n,t,o,r,l,i,d,u;const a=null===j||void 0===j||null===(e=j.getSingleCoupon)||void 0===e?void 0:e.data;k(null===a||void 0===a?void 0:a.userList.map((e=>({name:e.first_name,code:e.id})))),O.setValues({couponName:null===a||void 0===a||null===(n=a.coupon)||void 0===n?void 0:n.coupon_name,couponCode:null===a||void 0===a||null===(t=a.coupon)||void 0===t?void 0:t.coupon_code,startTime:(0,C.eW)(null===a||void 0===a||null===(o=a.coupon)||void 0===o?void 0:o.start_time,s.DX.simpleDateFormat),expireTime:(0,C.eW)(null===a||void 0===a||null===(r=a.coupon)||void 0===r?void 0:r.expire_time,s.DX.simpleDateFormat),percentage:null===a||void 0===a||null===(l=a.coupon)||void 0===l?void 0:l.percentage,couponType:JSON.stringify(null===a||void 0===a||null===(i=a.coupon)||void 0===i?void 0:i.coupon_type),isReusable:JSON.stringify(null===a||void 0===a||null===(d=a.coupon)||void 0===d?void 0:d.is_reusable),applicable:JSON.stringify(null===a||void 0===a||null===(u=a.coupon)||void 0===u?void 0:u.applicable)}).catch((e=>{p.oR.error(e)}))}}),[null===j||void 0===j?void 0:j.getSingleCoupon]);const O=(0,m.Wx)({initialValues:{couponName:"",couponCode:"",startTime:"",expireTime:"",percentage:0,radio:"",couponType:"0",isReusable:"",applicable:""},validationSchema:A,onSubmit:t=>{const o={couponName:t.couponName,couponCode:t.couponCode,couponType:"0"===t.couponType?0:1,startTime:t.startTime,expireTime:t.expireTime,percentage:t.percentage,applicable:"0"===t.applicable?0:1,selectedUsers:R.map((e=>e.code)),isReusable:"0"===t.isReusable?0:1};a.id?function(a,t){0!==R.length&&N({variables:{updateCouponId:t,...a}}).then((e=>{const a=e.data;200===a.updateCoupon.meta.statusCode?(p.oR.success(a.updateCoupon.meta.message),n("/".concat(s.bw.app,"/").concat(s.bw.manageOffer,"/list")),O.resetForm(),w()):p.oR.error(a.updateCoupon.meta.message)})).catch((()=>{p.oR.error(e("Failed to update"))}))}(o,+a.id):function(a){0!==R.length&&S({variables:{...a,createdBy:1}}).then((e=>{const a=e.data;200===a.createCoupon.meta.statusCode||201===a.createCoupon.meta.statusCode?(p.oR.success(a.createCoupon.meta.message),n("/".concat(s.bw.app,"/").concat(s.bw.manageOffer,"/list")),O.resetForm()):p.oR.error(a.createCoupon.meta.message)})).catch((()=>{p.oR.error(e("Failed to create"))}))}(o)}}),w=(0,i.useCallback)((()=>{n("/".concat(s.bw.app,"/").concat(s.bw.manageOffer,"/list"))}),[]);(0,i.useEffect)((()=>{if(null!==y&&void 0!==y&&y.getUsers){var e;const n=null===y||void 0===y||null===(e=y.getUsers)||void 0===e?void 0:e.data;D(null===n||void 0===n?void 0:n.userList.map((e=>({name:e.first_name,code:e.id}))))}if("0"===O.values.applicable&&null!==y&&void 0!==y&&y.getUsers){var n;const e=null===y||void 0===y||null===(n=y.getUsers)||void 0===n?void 0:n.data;k(null===e||void 0===e?void 0:e.userList.map((e=>({name:e.first_name,code:e.id}))))}}),[O.values.applicable]);const U=e=>O.errors[e]&&O.touched[e]?O.errors[e]:"",L=(0,i.useCallback)((e=>{k(e.value)}),[k]),B=(0,i.useCallback)((e=>{O.setFieldValue(e.target.name,(0,C.AW)(e))}),[]);return(0,f.jsx)("div",{children:(0,f.jsx)("div",{className:"w-full ",children:(0,f.jsx)(T.A,{errors:O.errors,touched:O.touched,setFieldTouched:O.setFieldTouched,children:(0,f.jsxs)("form",{className:"bg-white shadow-md rounded  pt-6 mb-4 border border-[#c8ced3]",onSubmit:O.handleSubmit,children:[(0,f.jsx)("div",{className:"flex justify-end pr-8 pb-2",children:(0,f.jsxs)("p",{children:[e("Fields marked with")," ",(0,f.jsx)("span",{className:"text-red-500",children:"*"})," ",e("are mandatory.")]})}),(0,f.jsxs)("div",{className:"grid grid-cols-1 px-8 md:grid-cols-2  gap-4",children:[(0,f.jsx)("div",{children:(0,f.jsx)(g.A,{required:!0,placeholder:e("Offer Name"),name:"couponName",onChange:O.handleChange,onBlur:B,label:e("Offer Name"),value:O.values.couponName,error:U("couponName")})}),(0,f.jsx)("div",{children:(0,f.jsx)(g.A,{required:!0,placeholder:e("Offer Code"),name:"couponCode",onChange:O.handleChange,onBlur:B,label:e("Offer Code"),value:O.values.couponCode,error:U("couponCode")})}),(0,f.jsx)("div",{children:(0,f.jsx)(h.A,{id:"couponType",checked:O.values.couponType,onChange:O.handleChange,name:"couponType",radioOptions:[{name:e("Percentage"),key:0},{name:e("Amount"),key:1}],label:e("Type"),required:!0,error:O.errors.couponType&&O.touched.couponType?O.errors.couponType:""})}),(0,f.jsx)("div",{children:(0,f.jsx)(g.A,{type:"number",placeholder:e("Value"),name:"percentage",onChange:O.handleChange,label:"0"===O.values.couponType?"".concat(e("Value"),"(%)"):e("Value"),value:O.values.percentage,error:U("percentage")})}),(0,f.jsx)("div",{children:(0,f.jsx)(g.A,{required:!0,type:"date",placeholder:e("start Date"),name:"startTime",onChange:O.handleChange,label:e("Start Date"),value:O.values.startTime,error:U("startTime"),min:a.id?O.values.startTime:x()().format(s.DX.simpleDateFormat),disabled:!!a.id})}),(0,f.jsx)("div",{children:(0,f.jsx)(g.A,{required:!0,type:"date",placeholder:e("End Date"),disabled:!O.values.startTime,name:"expireTime",onChange:O.handleChange,label:e("End Date"),value:O.values.expireTime,error:O.values.startTime&&U("expireTime"),min:O.values.startTime})}),(0,f.jsx)("div",{className:"mb-4",children:(0,f.jsx)(h.A,{id:"isReusable",required:!0,checked:""===O.values.isReusable?"2":O.values.isReusable,onChange:O.handleChange,name:"isReusable",radioOptions:[{name:e("One Time"),key:0},{name:e("Multiple Time"),key:1}],label:e("Usage"),error:U("isReusable")})}),(0,f.jsx)("div",{children:(0,f.jsx)(h.A,{id:"applicable",required:!0,checked:""===O.values.applicable?"2":O.values.applicable,onChange:O.handleChange,name:"applicable",radioOptions:[{name:e("All"),key:0},{name:e("Selected users"),key:1}],label:e("Applicable"),error:U("applicable")})}),"1"===O.values.applicable&&(0,f.jsxs)("div",{className:"mb-4",children:[(0,f.jsxs)("label",{htmlFor:"selectedUsers",className:"ml-1 text-gray-700",children:[e("Selected users")," ",(0,f.jsx)("span",{className:"text-red-500  ",children:"*"})]}),(0,f.jsx)("div",{className:"mt-3",children:(0,f.jsx)($.K,{value:R,onChange:L,options:F,optionLabel:"name",display:"chip",placeholder:"".concat(e("Select user")),maxSelectedLabels:3,className:"w-full md:w-20rem "})}),"1"===O.values.applicable&&O.touched.applicable&&0===(null===R||void 0===R?void 0:R.length)&&(0,f.jsx)("p",{className:"text-red-500",children:e("Please select alteast one user")})]})]}),(0,f.jsxs)("div",{className:"btn-group col-span-3 flex items-center py-3 px-5 justify-start bg-slate-100   border border-[#c8ced3]",children:[(0,f.jsx)(v.A,{className:"btn-primary btn-normal",type:"submit",label:null!==a&&void 0!==a&&a.id?e("Update"):e("Save"),title:"".concat(null!==a&&void 0!==a&&a.id?e("Update"):e("Save")),children:(0,f.jsx)(_.rA,{className:"mr-1 text-white "})}),(0,f.jsx)(v.A,{className:"btn-warning btn-normal",label:e("Cancel"),onClick:w,title:"".concat(e("Cancel")),children:(0,f.jsx)(_.YY,{className:"mr-1 fill-white"})})]})]})})})})}}}]);
//# sourceMappingURL=5588.c9abed04.chunk.js.map